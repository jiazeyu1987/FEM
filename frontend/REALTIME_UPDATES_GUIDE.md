# 实时阈值更新功能用户指南

## 🎯 功能概述

HEM分析仪现在支持**实时阈值参数调整**，用户可以在不重新点击"检测波峰"按钮的情况下，实时调整阈值参数并立即看到时间轴颜色的变化。

## ⚡ 新增功能

### 自动重新检测
当以下参数发生变化时，系统会自动重新计算波峰颜色：

1. **帧差值阈值 (颜色判定)** - 控制红色/绿色波峰的分类
2. **绝对阈值 (灰度值)** - 控制波峰区域检测
3. **基线帧数** - 控制波峰边界扩展

### 智能触发条件
系统仅在满足以下条件时才会自动重新检测：
- ✅ 视频分析已完成
- ✅ 已有检测到的波峰
- ✅ 当前选择的是"绝对阈值"检测方法

## 🎨 颜色分类逻辑

- 🟩 **绿色波峰**: `(后5帧平均值 - 前5帧平均值) ≤ 阈值` (稳定事件)
- 🟥 **红色波峰**: `(后5帧平均值 - 前5帧平均值) > 阈值` (不稳定事件)
- ⬜ **白色波峰**: 边界情况，数据不足

## 📋 使用步骤

1. **分析视频** - 首先加载并分析视频
2. **选择阈值法** - 确保选择"绝对阈值"检测方法
3. **检测波峰** - 点击"检测波峰"按钮进行初始检测
4. **实时调优** - 调整"帧差值阈值"参数，观察颜色实时变化

## 🔧 技术特性

### 防抖处理
- 300ms防抖延迟，避免频繁重新计算
- 快速连续参数调整时只执行最后一次重新检测

### 性能优化
- 智能触发条件，避免不必要的重新计算
- 详细的控制台日志，便于调试

### 用户反馈
- 控制台显示参数变化和重新检测状态
- 状态栏显示去重前后的波峰数量和颜色分布

## 📊 示例场景

### 调整帧差值阈值
```
阈值 = 2.1 (默认):
- 波峰A: 差值 = 1.5 → 绿色 (稳定)
- 波峰B: 差值 = 3.2 → 红色 (不稳定)

阈值调整到 3.0:
- 波峰A: 差值 = 1.5 → 绿色 (稳定)
- 波峰B: 差值 = 3.2 → 绿色 (变为稳定)
```

## 🚨 注意事项

1. **方法限制**: 实时更新仅在"绝对阈值"方法下有效
2. **数据要求**: 需要先完成视频分析和初始波峰检测
3. **性能考虑**: 频繁调整可能有轻微延迟，这是正常的防抖处理

## 🔍 故障排除

### 问题: 调整参数后没有变化
**解决方案:**
1. 确保选择的是"绝对阈值"检测方法
2. 确保视频分析已完成
3. 确保已经进行过初始波峰检测
4. 检查浏览器控制台是否有错误信息

### 问题: 更新太慢
**说明**: 这是正常的防抖处理，系统会在停止调整300ms后自动更新

## 📱 兼容性

- ✅ Chrome 80+
- ✅ Firefox 75+
- ✅ Safari 13+
- ✅ Edge 80+

---

*此功能显著提升了HEM分析仪的参数调优体验，用户现在可以实时观察阈值调整对波峰分类的影响。*