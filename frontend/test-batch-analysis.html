<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æ‰¹é‡åˆ†æåŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #252526;
            border: 1px solid #3c3c3c;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-section h2 {
            margin-top: 0;
            color: #e5e5e5;
            font-size: 18px;
        }
        .test-section p {
            color: #9da0a6;
            font-size: 14px;
            line-height: 1.5;
        }
        .test-controls {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .test-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .test-btn.primary {
            background: #0e639c;
            color: white;
        }
        .test-btn.primary:hover {
            background: #0b5a86;
        }
        .test-btn.secondary {
            background: #374151;
            color: white;
        }
        .test-btn.secondary:hover {
            background: #1f2937;
        }
        .test-btn.danger {
            background: #dc2626;
            color: white;
        }
        .test-btn.danger:hover {
            background: #b91c1c;
        }
        .test-status {
            background: #1f2937;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            color: #cbd5e1;
        }
        .features-list {
            background: #374151;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .feature-item:last-child {
            margin-bottom: 0;
        }
        .feature-icon {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            background: #22c55e;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        .feature-icon.pending {
            background: #f59e0b;
        }
        .feature-icon.processing {
            background: #3b82f6;
        }
        .feature-icon.completed {
            background: #10b981;
        }
        .feature-text {
            color: #e5e5e7;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="text-align: center; margin-bottom: 30px;">æ‰¹é‡åˆ†æåŠŸèƒ½æµ‹è¯•é¡µé¢</h1>

        <div class="test-section">
            <h2>ğŸ¯ åŠŸèƒ½æ¦‚è¿°</h2>
            <p>
                æœ¬é¡µé¢æ¼”ç¤ºäº†æ‰¹é‡åˆ†æåŠŸèƒ½çš„æ ¸å¿ƒç‰¹æ€§ï¼ŒåŒ…æ‹¬å¤šæ–‡ä»¶é€‰æ‹©ã€æ‹–æ‹½ä¸Šä¼ ã€æ‰¹é‡å¤„ç†é˜Ÿåˆ—ã€è¿›åº¦è·Ÿè¸ªå’Œç»“æœåˆ‡æ¢ç­‰åŠŸèƒ½ã€‚
            </p>

            <div class="features-list">
                <div class="feature-item">
                    <div class="feature-icon completed">âœ“</div>
                    <div class="feature-text">å¤šæ–‡ä»¶é€‰æ‹©å’Œæ‹–æ‹½ä¸Šä¼ </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon completed">âœ“</div>
                    <div class="feature-text">æ‰¹é‡å¤„ç†é˜Ÿåˆ—å¼•æ“</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon completed">âœ“</div>
                    <div class="feature-text">å®æ—¶è¿›åº¦è·Ÿè¸ªå’ŒçŠ¶æ€æ˜¾ç¤º</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon completed">âœ“</div>
                    <div class="feature-text">è§†é¢‘é€‰æ‹©ä¸‹æ‹‰æ¡†</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon completed">âœ“</div>
                    <div class="feature-text">åˆ†æç»“æœåˆ‡æ¢æ˜¾ç¤º</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon completed">âœ“</div>
                    <div class="feature-text">é”™è¯¯å¤„ç†å’Œæ¢å¤</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª æµ‹è¯•æ§åˆ¶</h2>
            <p>ä»¥ä¸‹æµ‹è¯•åŠŸèƒ½æ¨¡æ‹Ÿæ‰¹é‡åˆ†æçš„å®Œæ•´æµç¨‹ï¼š</p>

            <div class="test-controls">
                <button id="testFileList" class="test-btn primary">æ¨¡æ‹Ÿæ–‡ä»¶åˆ—è¡¨</button>
                <button id="testBatchProcess" class="test-btn secondary">æ¨¡æ‹Ÿæ‰¹é‡å¤„ç†</button>
                <button id="testProgress" class="test-btn secondary">æµ‹è¯•è¿›åº¦è·Ÿè¸ª</button>
                <button id="testVideoSwitch" class="test-btn primary">æµ‹è¯•è§†é¢‘åˆ‡æ¢</button>
                <button id="clearAll" class="test-btn danger">æ¸…é™¤æ‰€æœ‰</button>
            </div>

            <div id="testStatus" class="test-status">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š ä½¿ç”¨è¯´æ˜</h2>
            <p><strong>åœ¨å®é™…åº”ç”¨ä¸­ä½¿ç”¨æ‰¹é‡åˆ†æåŠŸèƒ½ï¼š</strong></p>
            <ol style="color: #9da0a6; font-size: 14px; line-height: 1.6;">
                <li>ç‚¹å‡»<strong>æ‰¹é‡åŠ è½½</strong>æŒ‰é’®é€‰æ‹©å¤šä¸ªMP4è§†é¢‘æ–‡ä»¶</li>
                <li>æˆ–ç›´æ¥æ‹–æ‹½è§†é¢‘æ–‡ä»¶åˆ°<strong>æ‹–æ‹½åŒºåŸŸ</strong></li>
<li>æŸ¥çœ‹å·²é€‰æ‹©æ–‡ä»¶åˆ—è¡¨ï¼Œå¯ä»¥ç§»é™¤ä¸éœ€è¦çš„æ–‡ä»¶</li>
                <li>ç‚¹å‡»<strong>æ‰¹é‡åˆ†æ</strong>å¼€å§‹è‡ªåŠ¨å¤„ç†é˜Ÿåˆ—</li>
                <li>è§‚å¯Ÿå®æ—¶è¿›åº¦å’ŒçŠ¶æ€ä¿¡æ¯</li>
                <li>åˆ†æå®Œæˆåï¼Œä½¿ç”¨<strong>è§†é¢‘é€‰æ‹©ä¸‹æ‹‰æ¡†</strong>åˆ‡æ¢æŸ¥çœ‹ä¸åŒè§†é¢‘çš„åˆ†æç»“æœ</li>
                <li>ä¿¡æ¯é¢æ¿ä¼šæ˜¾ç¤ºå½“å‰é€‰ä¸­è§†é¢‘çš„æ›²çº¿å€¼</li>
                <li>æ—¶é—´è½´ç‚¹å‡»åŠŸèƒ½é€‚ç”¨äºæ‰€æœ‰å·²åˆ†æçš„è§†é¢‘</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>âš™ï¸ æŠ€æœ¯ç‰¹æ€§</h2>
            <p><strong>æ‰¹é‡åˆ†æç³»ç»Ÿçš„æŠ€æœ¯å®ç°ï¼š</strong></p>
            <ul style="color: #9da0a6; font-size: 14px; line-height: 1.6;">
                <li><strong>é˜Ÿåˆ—å¤„ç†</strong>ï¼šé¡ºåºå¤„ç†é¿å…æœåŠ¡å™¨è¿‡è½½</li>
                <li><strong>é»˜è®¤ROI</strong>ï¼šè‡ªåŠ¨ä½¿ç”¨ä¸­å¿ƒ50%åŒºåŸŸä½œä¸ºROI</li>
                <li><strong>å†…å­˜ç®¡ç†</strong>ï¼šé«˜æ•ˆçš„å­˜å‚¨å’Œåˆ‡æ¢æœºåˆ¶</li>
                <li><strong>é”™è¯¯æ¢å¤</strong>ï¼šå•ä¸ªå¤±è´¥ä¸å½±å“æ•´ä½“å¤„ç†</li>
                <li><strong>è¿›åº¦å¯è§†åŒ–</strong>ï¼šæ•´ä½“å’Œå•ä¸ªè§†é¢‘çš„è¿›åº¦æ˜¾ç¤º</li>
                <li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šéé˜»å¡çš„ç”¨æˆ·ç•Œé¢</li>
            </ul>
        </div>
    </div>

    <script>
        // Test simulation variables
        let testBatchFiles = [];
        let testAnalyses = new Map();
        let testProcessing = false;
        let testCurrentIndex = 0;

        // Mock analysis data generator
        function generateMockAnalysis(file) {
            const duration = 10 + Math.random() * 10; // 10-20 seconds
            const fps = 8;
            const frames = Math.floor(duration * fps);

            const series = [];
            for (let i = 0; i < frames; i++) {
                const t = i / fps;
                const baseValue = 128;
                const variation = Math.sin(t * 0.5) * 30 + Math.random() * 10 - 5;
                const roiValue = Math.max(0, Math.min(255, baseValue + variation));
                series.push({
                    t: t,
                    roi: roiValue,
                    ref: 128 + Math.random() * 5 - 2.5,
                    std: 10 + Math.random() * 5,  // æ·»åŠ æ¨¡æ‹Ÿçš„æ ‡å‡†å·®æ•°æ®
                    high: 20 + Math.sin(t * 0.3) * 15 + Math.random() * 10  // æ·»åŠ æ¨¡æ‹Ÿçš„é«˜ç°åº¦åƒç´ å æ¯”æ•°æ®
                });
            }

            // éªŒè¯ç”Ÿæˆçš„æ•°æ®åŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µ
            if (series.length > 0 && (!series[0].hasOwnProperty('std') || !series[0].hasOwnProperty('high'))) {
                console.error('Generated mock data missing required fields');
                console.log('Available fields:', Object.keys(series[0]));
                throw new Error('Mock data generation failed: missing std or high field');
            }
            console.log('Mock data generated successfully, samples - std:', series[0].std.toFixed(2), 'high:', series[0].high.toFixed(1));

            return {
                id: file.name + '_' + file.size,
                fileName: file.name,
                file: file,
                status: 'completed',
                progress: 100,
                error: null,
                results: {
                    has_hem: Math.random() > 0.6,
                    events: Array.from({length: Math.floor(Math.random() * 5)}, (_, i) => ({
                        t: Math.random() * duration,
                        type: ['sudden', 'threshold', 'relative'][Math.floor(Math.random() * 3)],
                        score: Math.random() * 100
                    })),
                    baseline: 120 + Math.random() * 20,
                    series: series
                }
            };
        }

        // Test functions
        function updateTestStatus(message) {
            document.getElementById('testStatus').textContent = new Date().toLocaleTimeString() + ' - ' + message;
        }

        // Event listeners
        document.getElementById('testFileList').addEventListener('click', () => {
            // Simulate loading multiple files
            testBatchFiles = [
                { name: 'test_video_001.mp4', size: 1024000, type: 'video/mp4' },
                { name: 'test_video_002.mp4', size: 2048000, type: 'video/mp4' },
                { name: 'medical_scan_001.mp4', size: 5120000, type: 'video/mp4' },
                { name: 'medical_scan_002.mp4', size: 3072000, type: 'video/mp4' }
            ];
            updateTestStatus(`æ¨¡æ‹ŸåŠ è½½ ${testBatchFiles.length} ä¸ªæ–‡ä»¶: ${testBatchFiles.map(f => f.name).join(', ')}`);
            console.log('ğŸ“ æ¨¡æ‹Ÿæ–‡ä»¶åˆ—è¡¨:', testBatchFiles);
        });

        document.getElementById('testBatchProcess').addEventListener('click', async () => {
            if (testBatchFiles.length === 0) {
                updateTestStatus('è¯·å…ˆæ¨¡æ‹ŸåŠ è½½æ–‡ä»¶');
                return;
            }

            testProcessing = true;
            testCurrentIndex = 0;
            updateTestStatus('å¼€å§‹æ‰¹é‡å¤„ç†...');

            // Process files with realistic timing
            for (let i = 0; i < testBatchFiles.length; i++) {
                if (!testProcessing) break;

                testCurrentIndex = i;
                const file = testBatchFiles[i];
                updateTestStatus(`æ­£åœ¨å¤„ç† ${i + 1}/${testBatchFiles.length}: ${file.name}`);

                // Simulate processing delay
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));

                // Generate mock analysis
                const analysis = generateMockAnalysis(file);
                testAnalyses.set(analysis.id, analysis);

                updateTestStatus(`å·²å®Œæˆ ${i + 1}/${testBatchFiles.length}: ${file.name} (æ£€æµ‹åˆ° ${analysis.results.events.length} ä¸ªHEMäº‹ä»¶)`);
            }

            testProcessing = false;
            updateTestStatus(`æ‰¹é‡å¤„ç†å®Œæˆï¼å…±å¤„ç† ${testBatchFiles.length} ä¸ªæ–‡ä»¶`);
            console.log('âœ… æ‰¹é‡å¤„ç†å®Œæˆï¼Œåˆ†æç»“æœ:', testAnalyses);
        });

        document.getElementById('testProgress').addEventListener('click', () => {
            if (testBatchFiles.length === 0) {
                updateTestStatus('æ²¡æœ‰å¯æ˜¾ç¤ºçš„è¿›åº¦æ•°æ®');
                return;
            }

            const progress = testProcessing ? testCurrentIndex : testBatchFiles.length;
            const percentage = Math.round((progress / testBatchFiles.length) * 100);
            updateTestStatus(`è¿›åº¦è·Ÿè¸ª: ${progress}/${testBatchFiles.length} (${percentage}%)`);

            // Show detailed progress info
            if (testAnalyses.size > 0) {
                const analyses = Array.from(testAnalyses.values());
                const totalEvents = analyses.reduce((sum, a) => sum + a.results.events.length, 0);
                const hemDetected = analyses.filter(a => a.results.has_hem).length;
                updateTestStatus(`è¿›åº¦è·Ÿè¸ª: ${progress}/${testBatchFiles.length} (${percentage}%) | æ€»äº‹ä»¶: ${totalEvents} | HEMæ£€æµ‹: ${hemDetected}`);
            }
        });

        document.getElementById('testVideoSwitch').addEventListener('click', () => {
            if (testAnalyses.size === 0) {
                updateTestStatus('æ²¡æœ‰å¯åˆ‡æ¢çš„åˆ†æç»“æœ');
                return;
            }

            const analyses = Array.from(testAnalyses.values());
            const currentIndex = analyses.findIndex(a => a.id === (window.currentTestVideoId || ''));
            const nextIndex = (currentIndex + 1) % analyses.length;
            const nextAnalysis = analyses[nextIndex];

            window.currentTestVideoId = nextAnalysis.id;
            updateTestStatus(`åˆ‡æ¢åˆ°è§†é¢‘: ${nextAnalysis.fileName}`);
            updateTestStatus(`åˆ‡æ¢è¯¦æƒ…: æ—¶é•¿ ${nextAnalysis.results.series[nextAnalysis.results.series.length-1].t.toFixed(1)}s | äº‹ä»¶æ•°: ${nextAnalysis.results.events.length} | HEM: ${nextAnalysis.results.has_hem ? 'æ˜¯' : 'å¦'}`);

            console.log('ğŸ”„ åˆ‡æ¢åˆ°åˆ†æ:', nextAnalysis);
        });

        document.getElementById('clearAll').addEventListener('click', () => {
            testBatchFiles = [];
            testAnalyses.clear();
            testProcessing = false;
            testCurrentIndex = 0;
            window.currentTestVideoId = null;
            updateTestStatus('å·²æ¸…é™¤æ‰€æœ‰æµ‹è¯•æ•°æ®');
            console.log('ğŸ—‘ï¸ æ¸…é™¤å®Œæˆ');
        });

        // Initialize
        updateTestStatus('æ‰¹é‡åˆ†ææµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•');
        console.log('ğŸ¯ æ‰¹é‡åˆ†ææµ‹è¯•é¡µé¢å‡†å¤‡å®Œæˆ');
    </script>
</body>
</html>